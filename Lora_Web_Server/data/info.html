<!DOCTYPE html>
<html>

<head>
  <title>SMART FARM DASHBOARD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="bootstrap.min.css">
  <script src="gauge.min.js"></script>
</head>

<body>
  <nav class="navbar nav-top bg-light">
    <div class="container">
      <div class="navbar-brand">
        <img src="ug.png" width="100" height="100" alt="No Image Found!" class="no-space">
        <img src="kampusmerdeka.png" width="100" height="100" alt="No Image Found!" class="space">
        <img src="kampusmerdekaa.png" width="100" height="100" alt="No Image Found!" class=" space">
        <img src="ppunew.png" width="100" height="100" alt="No Image Found!" class="space">
        <img src="diktii.png" width="100" height="100" alt="No Image Found!" class="space">
      </div>
    </div>
  </nav>
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo03"
        aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
        <ul class="nav">
          <li class="nav-item ">
            <a class="nav-link " href="index.html">
              <p class="lahan"> Lahan 1</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="lahan2.html">
              <p class="lahan"> Lahan 2</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="lahan3.html">
              <p class="lahan"> Lahan 3</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="lahan4.html">
              <p class="lahan"> Lahan 4</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="info.html">
              <p class="lahan">INFO</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


  <div class="container">
    <br>
    <p class="judul-proyek text-center">Informasi Indikator Bar</p>
    <br>
    <div class="row">
      <div class="col-md-3">
        <div class="card card-info">
          <p class="card-title">Nitrogen</p>
          <canvas id="natriumLahan1"></canvas>
        </div>
      </div>
      <div class="col-md-9">
        <p class="head-des">Nitrogen</p>
        <hr>
        <p class="info-des"> Indikator bar ini menampilkan berapa nilai kadar Nitrogen yang ada pada tanah yang diukur
          menggunakan sensor NPK RS485.Pembacaan nilai kadar ini dilakukan sekali baca sehingga apabila sewaktu-waktu 
          ada perubahan kondisi setelah pemberian pupuk/nutrisi kita dapat melihat perubahan kadar Nitrogen tersebut
          dengan cara menekan button reset yang terdapat pada sisi box. Nilai kadar Nitrogen pada tanah sendiri umumnya
          berkisar antara 0-255ppm, yang mana nilai tersebut dapat dibagi menjadi beberapa kriteria. Kriteria tersebut
          diindikasikan dengan perubahan warna, warna yang sama digunakan untuk menunjukkan kategori tingkat tanah 
          dalam kondisi rendah, sedang, tinggi. Penggolongan nilai range tersebut adalah 0-50ppm Rendah, 51- 130ppm sedang, dan 
          131-ppm Tinggi 
        
        </p>
      </div>
      <p class="head-artikel">Artikel</p>
      <p class="artikel-conten">Nitrogen bagi tanaman berperan dalam proses penyerapan cahaya melalui pembentukan 
        klorofil (Suminarti, 2011). Nitrogen diperlukan tanaman untuk pembentukan dan pertumbuhan bagian vegetatif 
        tanaman seperti akar, batang dan daun. Selain itu, nitrogen berperan dalam sintesi klorofil (Harjoko, 2005). 
        Fungsi Nitrogen yang selengkapnya bagi tanaman adalah sebagai berikut: untuk meningkatkan pertumbuhan tanaman, 
        dapat menyehatkan pertumbuhan daun, meningkatkan kadar protein dalam tubuh tanaman, meningkatkan kualitas tanaman 
        penghasil daun, meningkatkan perkembangan mikroorganisme dalam tanah (Kartasapoetra dan Sutedja, 2000).
      </p>
      <!-- batch 2 -->
      <div class="row">
        <div class="col-md-9">
          <p class="head-des">Phospor</p>
          <hr>
          <p class="info-des">Indikator bar ini menampilkan berapa nilai kadar Phospor yang ada pada tanah yang diukur
            menggunakan sensor NPK RS485.Pembacaan nilai kadar ini dilakukan sekali baca sehingga apabila sewaktu-waktu 
            ada perubahan kondisi setelah pemberian pupuk/nutrisi kita dapat melihat perubahan kadar Phospor tersebut
            dengan cara menekan button reset yang terdapat pada sisi box. Nilai kadar Phospor pada tanah sendiri umumnya
            berkisar antara 0-255ppm, yang mana nilai tersebut dapat dibagi menjadi beberapa kriteria. Kriteria tersebut
            diindikasikan dengan perubahan warna, warna yang sama digunakan untuk menunjukkan kategori tingkat tanah 
            dalam kondisi rendah, sedang, tinggi. Penggolongan nilai range tersebut adalah 0-50ppm Rendah, 51- 130ppm sedang, dan 
            131-ppm Tinggi 
          </p>
        </div>
        <div class="col-md-3">
          <div class="card-info">
            <p class="card-title">Phospor</p>
            <canvas id="potasiumLahan1"></canvas>
          </div>
        </div>
      </div>
      <p class="head-artikel">Artikel</p>
      <p class="artikel-conten">Fungsi penting unsur P pada tanaman yaitu berperan dalam proses fotosintesis, respirasi, 
        transfer dan penyimpanan energi, pembelahan dan pembesaran sel serta proses-proses di dalam tanaman lainnya. 
        Unsur P sangat penting dalam pembentukan biji, membantu mempercepat perkembangan akar dan perkecambahan, 
        dapat meningkatkan efisiensi penggunaan air, meningkatkan daya tahan terhadap penyakit yang akhirnya meningkatkan 
        kualitas hasil panen (Irwanto, 2014), mempercepat pembungaan serta pemasakan buah dan biji 
        (Walid dan Susylowati, 2016).</p>
      <!-- bach 4 -->
      <div class="row">
        <div class="col-md-3">
          <div class="card card-info">
            <p class="card-title">Kalium</p>
            <canvas id="kaliumLahan1"></canvas>
          </div>
        </div>
        <div class="col-md-9">
          <p class="head-des">Kalium</p>
          <hr>
          <p class="info-des">Indikator bar ini menampilkan berapa nilai kadar Kalium yang ada pada tanah yang diukur
            menggunakan sensor NPK RS485.Pembacaan nilai kadar ini dilakukan sekali baca sehingga apabila sewaktu-waktu 
            ada perubahan kondisi setelah pemberian pupuk/nutrisi kita dapat melihat perubahan kadar Kalium tersebut
            dengan cara menekan button reset yang terdapat pada sisi box. Nilai kadar Kalium pada tanah sendiri umumnya
            berkisar antara 0-255ppm, yang mana nilai tersebut dapat dibagi menjadi beberapa kriteria. Kriteria tersebut
            diindikasikan dengan perubahan warna, warna yang sama digunakan untuk menunjukkan kategori tingkat tanah 
            dalam kondisi rendah, sedang, tinggi. Penggolongan nilai range tersebut adalah 0-50ppm Rendah, 51- 130ppm 
            sedang, dan 131-ppm Tinggi
          </p>
        </div>
        <p class="head-artikel">Artikel</p>
        <p class="artikel-conten">Kalium memegang peranan penting didalam metabolisme tanaman (Farhad et al., 2010), 
          membantu pembentukan protein, karbohidrat, aktivitas enzim, regulasi osmotik, efisiensi penggunaan air, 
          translokasi fotosintat (McKenzie, 2001), merangsang perkembangan akar dan meningkatkan ukuran buah 
          (Marsono dan Sigit, 2001). Pemberian Kalium dapat meningkatkan terbentuknya senyawa lignin yang lebih tebal,
          sehingga dinding sel menjadi lebih kuat yang pada akkhirnya dinding sel menjadi lebih kuat dan dapat melindungi 
          tanaman dari gangguan patogen (Fageria et al., 2009).</p>
        <!-- batch 2 -->
        <div class="row">
          <div class="col-md-9">
            <p class="head-des">Kelembaban</p>
            <hr>
            <p class="info-des">Bar ini berisi nilai baca yang dihasilkan oleh sensor kelembababan yang mendeteksi
              kelembababan tanah. Kelembaban tanahnya sendiri diberi nilai menggunakan notasi persentase 0-100%, nilai
              tersebut digunakan untuk menotasikan tingkat kelembababan pada tanah.Tingkat kelembaban pada sistem ini dibagi
              menjadi 3 kondisi yaitu, 0%-30% kering,31%-60% sedang, > 60% basah.
            </p>
          </div>
          <div class="col-md-3">
            <div class="card-info">
              <p class="card-title">Kelembaban</p>
              <canvas id="KelembabanLahan1"></canvas>
            </div>
          </div>
        </div>
        <p class="head-artikel">Artikel</p>
        <p class="artikel-conten">Kadar air tanah atau kelembaban tanah untuk tanaman berkisar 60 â€“ 80%. Keadaan 
          tersebut akan merangsang pertumbuhan untuk tanaman yang masih muda karena asimilasi CO2 menjadi lebih 
          baik melalui stomata yang membuka lebih banyak (Afifah et al., 2020).</p>
        <div class="row">
          <div class="col-md-3">
            <div class="card card-info">
              <p class="card-title">pH</p>
              <canvas id="phLahan1"></canvas>
            </div>
          </div>
          <div class="col-md-9">
            <p class="head-des">pH</p>
            <hr>
            <p class="info-des">Indikator ini menunjukkan hasil baca dari sensor pH dalam mengukur tingkat pH tanah. 
              PH tanah dapat dinotasikan mulai dari 0-14, dimana 0-4,5 Sangat Masam,  5,5-6,5 Agak Masam,
              6,6-7,5 Netral, 7,6-8,5 Agak alkalis, > 8,5 Alkalis
            </p>
          </div>
          <p class="head-artikel">Artikel</p>
          <p class="artikel-conten">Tingkat kemasaman tanah (pH) yang sesuai untuk budidaya tomat ialah berkisar 5,0-7,0. 
            Akar tanaman tomat rentan terhadap kekurangan oksigen. Oleh karena itu, tanaman tomat tidak boleh tergenangi 
            oleh air. Dalam pembudidayaan tanaman tomat, sebaiknya dipilih lokasi yang topografi tanahnya datar, sehingga 
            tidak perlu dibuat teras-teras dan tanggul (Leovini, 2012). </p>
          <footer>
            <div class="foot">
              <h6 class="foot-text">Copyright &copy; <a href="https://ps-citra.gunadarma.ac.id"
                  style="text-decoration:none">
                  Research Team of Multimedia dan Robotics</a> </h6>
            </div>
          </footer>
          <!-- <script src="script.js"></script> -->
          <!-- <script src="./framework/js/bootstrap.bundle.js"></script> -->
          <script src="bootstrap.bundle.js"></script>
</body>
<script>
  //Get current sensor readings when the page loads
  window.addEventListener('load', getReadings);
  let widthGauge = 170;
  let heightGauge = 170;
  let majorTickVarNatrium = ["0",
    "25",
    "50",
    "75",
    "100",
    "125",
    "150",
    "175",
    "200",
    "225",
    "255"
  ]
  let majorTickPotasium = [
    "0",
    "25",
    "50",
    "75",
    "100",
    "125",
    "150",
    "175",
    "200",
    "225",
    "255"
  ]
  let majorTickKalium = ["0",
    "25",
    "50",
    "75",
    "100",
    "125",
    "150",
    "175",
    "200",
    "225",
    "255"
  ]
  let majorTickpH = ["0",
    "1",
    "2",
    "3",
    "4",
    "5",
    "6",
    "7",
    "8",
    "9",
    "10",
    "11",
    "12",
    "13",
    "14"
  ]
  let majorTickSoil = ["0",
    "10",
    "20",
    "30",
    "40",
    "50",
    "60",
    "70",
    "80",
    "90",
    "100"
  ]
  let heightNatrium = [{
      "from": 0,
      "to": 45,
      "color": "#D4DBA1"
    },
    {
      "from": 45,
      "to": 90,
      "color": "#CFDE64"
    }, {
      "from": 90,
      "to": 140,
      "color": "#D0E43B"
    }, {
      "from": 140,
      "to": 255,
      "color": "#E0FF00"
    }
  ]
  let heightPotasium = [{
      "from": 150,
      "to": 255,
      "color": "#f20202"
    },
    {
      "from": 0,
      "to": 45,
      "color": "#dbd7cc"
    }, {
      "from": 45,
      "to": 90,
      "color": "#f2ee02"
    }, {
      "from": 90,
      "to": 150,
      "color": "#02f262"
    }
  ]
  let heightKalium = [{
      "from": 150,
      "to": 255,
      "color": "#f20202"
    },
    {
      "from": 0,
      "to": 45,
      "color": "#dbd7cc"
    }, {
      "from": 45,
      "to": 90,
      "color": "#f2ee02"
    }, {
      "from": 90,
      "to": 150,
      "color": "#02f262"
    }
  ]
  let heightpH = [{
      "from": 0,
      "to": 2,
      "color": "#E62300"
    },
    {
      "from": 2,
      "to": 4,
      "color": "#DE4B31"
    }, {
      "from": 4,
      "to": 6,
      "color": "#DB6B57"
    },
    {
      "from": 6,
      "to": 8,
      "color": "#A5EA0F"
    },
    {
      "from": 8,
      "to": 10,
      "color": "#9AD321"
    },
    {
      "from": 10,
      "to": 14,
      "color": "#3585DE"
    }
  ]
  let heightSoil = [{
      "from": 0,
      "to": 20,
      "color": "#C2D2EE"
    },
    {
      "from": 20,
      "to": 60,
      "color": "#8EB2EC"
    }, {
      "from": 60,
      "to": 80,
      "color": "#5B92ED"
    }, {
      "from": 80,
      "to": 100,
      "color": "#4082EE"
    }
  ]
  let colorPlatevar = "#fff";
  let needleTypeVar = 'arrow';
  let minorTicksVar = 10;

  var natriumLahan1Gauge = new RadialGauge({
    renderTo: 'natriumLahan1',
    width: widthGauge,
    height: heightGauge,
    units: "ppm",
    minValue: 0,
    maxValue: 255,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 0,
    majorTicks: majorTickVarNatrium,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightNatrium,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();

  var potasiumLahan1Gauge = new RadialGauge({
    renderTo: 'potasiumLahan1',
    width: widthGauge,
    height: heightGauge,
    units: "ppm",
    minValue: 0,
    maxValue: 255,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 1,
    majorTicks: majorTickPotasium,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightPotasium,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();

  var kaliumLahan1Gauge = new RadialGauge({
    renderTo: 'kaliumLahan1',
    width: widthGauge,
    height: heightGauge,
    units: "ppm ",
    minValue: 0,
    maxValue: 255,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 1,
    majorTicks: majorTickKalium,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightKalium,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();

  var KelembabanLahan1Gauge = new RadialGauge({
    renderTo: 'KelembabanLahan1',
    width: widthGauge,
    height: heightGauge,
    units: "Humidity (%)",
    minValue: 0,
    maxValue: 100,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 1,
    majorTicks: majorTickSoil,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightSoil,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();

  var phLahan1Gauge = new RadialGauge({
    renderTo: 'phLahan1',
    width: widthGauge,
    height: heightGauge,
    units: "",
    minValue: 0,
    maxValue: 14,
    colorValueBoxRect: "#049faa",
    colorValueBoxRectEnd: "#049faa",
    colorValueBoxBackground: "#f1fbfc",
    valueInt: 1,
    majorTicks: majorTickpH,
    minorTicks: minorTicksVar, // edited 4
    strokeTicks: true,
    highlights: heightpH,
    colorPlate: colorPlatevar,
    borderShadowWidth: 1, // edited 0
    borders: true,
    colorNeedle: "#007F80",
    colorNeedleEnd: "#007F80",
    needleWidth: 2,
    needleCircleSize: 3,
    colorNeedleCircleOuter: "#007F80",
    needleCircleOuter: true,
    needleCircleInner: false,
    needleType: needleTypeVar,
    animationDuration: 500, // edited 1500
    animationRule: "bounce"
  }).draw();


  // Function to get current readings on the webpage when it loads for the first time
  function getReadings() {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        var myObj = JSON.parse(this.responseText);
        console.log(myObj);

        let natriumLahan1Var = myObj.natriumLahan1FromArduino;
        let kelembabanLahan1Var = myObj.kelembabanLahan1FromArduino;
        let potasiumLahan1Var = myObj.potasiumLahan1FromArduino;
        let kaliumLahan1Var = myObj.kaliumLahan1FromArduino;
        let phLahan1Var = myObj.phLahan1FromArduino;

        KelembabanLahan1Gauge.value = kelembabanLahan1Var;
        natriumLahan1Gauge.value = natriumLahan1Var;
        potasiumLahan1Gauge.value = potasiumLahan1Var;
        kaliumLahan1Gauge.value = kaliumLahan1Var;
        phLahan1Gauge.value = phLahan1Var;



        // console.log(kelembabanLahan1Var);
        // console.log(natriumLahan1Var);
        // console.log(potasiumLahan1Var);
        // console.log(kaliumLahan1Var);
        // console.log(phLahan1Var);

      }
    };

    xhr.open("GET", "/readings", true);
    xhr.send();
  }

  if (!!window.EventSource) {
    var source = new EventSource('/events');

    source.addEventListener('open', function (e) {
      console.log("Events Connected");
    }, false);

    source.addEventListener('error', function (e) {
      if (e.target.readyState != EventSource.OPEN) {
        console.log("Events Disconnected");

      }
    }, false);

    source.addEventListener('message', function (e) {
      console.log("message", e.data);
    }, false);

    source.addEventListener('new_readings', function (e) {
      console.log("new_readings", e.data);
      var myObj = JSON.parse(e.data);
      // console.log(myObj);

      KelembabanLahan1Gauge.value = myObj.kelembabanLahan1FromArduino;
      kaliumLahan1Gauge.value = myObj.kaliumLahan1FromArduino;
      potasiumLahan1Gauge.value = myObj.potasiumLahan1FromArduino;
      natriumLahan1Gauge.value = myObj.natriumLahan1FromArduino;
      phLahan1Gauge.value = myObj.phLahan1FromArduino

      let sensorKel = KelembabanLahan1Gauge.value;
      console.log(sensorKel);

      if (sensorKel >= 41 && sensorKel <= 100) {
        document.getElementById("kelembaban").value = "Status : Basah";
        console.log("basah");
      } else {
        document.getElementById("kelembaban").value = "Status : Kering";
        console.log("Kering");
      }
      let sensorpH = phLahan1Gauge.value;
      console.log(sensorpH);
      if (sensorpH <= 6) {
        document.getElementById("pH").value = "Status : Asam";
        console.log("ASAM");
      } else if (sensorpH >= 7 && sensorpH <= 9) {
        document.getElementById("pH").value = "Status : Netral";
        console.log("Netral");
      } else if (sensorpH >= 10 && sensorpH <=
        14) {
        document.getElementById("pH").value = "Status : Basa";
        console.log("Basa");
      } //
      gaugeSoil_D.value = myObj.moisture;
    }, false);
  }
</script>

</html>
